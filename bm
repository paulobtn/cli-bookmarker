#!/bin/sh

function join_by { local d=${1-} f=${2-}; if shift 2; then printf %s "$f" "${@/#/$d}"; fi; }

# will load from a configuration file, but for now it just takes the 
# default browser that should be exported in .profile or .bash_profile

LAUNCHER=${BROWSER}
EDITOR_SOFTWARE=${EDITOR}

case $1 in
    "-a") 
        #add bookmark
        DESCRIPTION=""
        if [[ $3 = "-d" ]]; then
            DESCRIPTION=$4
        else 
            DESCRIPTION=$3
        fi
        echo $2 $DESCRIPTION >> bookmarks
        ;;
    "-l") 
        #list bookmarks
        cat -n bookmarks
        ;;
    "-r") 
        #remove bookmark if id is provided
        if [ ! -z "$2" ]; then        
            # add lines that will be deleted to an array
            arr=()
            while (( "$#-1" )); do
                arr+=($2d)
                shift 
            done

            #delete the lines           
            sed -i.bak `join_by ";" $(printf '%s\n' "${arr[*]}")` ./bookmarks 

        else
            echo "you need to provide an id"
        fi
        ;;
    "-o"|""|"-s") 
        #open bookmark
        if [ -z "$2" ]; then 
            # id not provided, open search prompt
            LINE=`cat ./bookmarks | fzf`
            echo $LINE
            if [ ! -z "$LINE" ]; then 
                # open the selected url
                $LAUNCHER `echo $LINE | awk '{print $1}'`
            fi
        else
            #id is provided, open url
            $LAUNCHER `sed -n $2p ./bookmarks | awk '{print $1}'`;
        fi
        ;;
    "-e")
        #edit with text editor
        ${EDITOR_SOFTWARE} ./bookmarks 
        ;;        
    *)
        echo "invalid option";;
esac


